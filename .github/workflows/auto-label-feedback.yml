name: Auto Label Feedback

on:
  issues:
    types:
      - opened
      - edited
      - reopened

permissions:
  issues: write

jobs:
  label-feedback:
    runs-on: ubuntu-latest
    steps:
      - name: Add feedback label when issue looks like feedback
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const issue_number = context.payload.issue.number;

            const title = (context.payload.issue.title || '').toLowerCase();
            const body = (context.payload.issue.body || '').toLowerCase();
            const text = `${title}\n${body}`;

            const feedbackKeywords = [
              'feedback',
              'suggestion',
              'improvement',
              'enhancement',
              'idea',
              'request',
              'proposal',
              'roadmap',
              'polish',
            ];

            const matchesFeedback = feedbackKeywords.some(keyword => text.includes(keyword));
            if (!matchesFeedback) {
              core.info('No feedback keywords matched.');
              return;
            }

            const labels = (context.payload.issue.labels || []).map(label => label.name);
            if (labels.includes('feedback')) {
              core.info('Issue already labeled feedback.');
              return;
            }

            await github.rest.issues.addLabels({
              owner,
              repo,
              issue_number,
              labels: ['feedback'],
            });
